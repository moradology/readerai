# ----------  Caddyfile  ----------
localhost {

	# Static files for the SPA
	root * /srv

	encode gzip

	log {
		output stdout
		format console
	}

	@nonstatic path /ws

	handle @nonstatic {
		reverse_proxy backend:8000 {
			stream_close_delay 5m
		}
	}

	@js path *.js
	header @js Content-Type text/javascript
	@css path *.css
	header @css Content-Type text/css

	
	# ─── Backend routes ────────────────────────────────
	# Plain‑path WebSocket (e.g. wss://localhost/ws)

	# Other explicit API endpoints
	reverse_proxy /initial_passage_http backend:8000
	reverse_proxy /chat_http           backend:8000

	# Everything under /demo/ (including /demo/ws) → backend /
	# `handle_path` strips the /demo prefix automatically.
	handle_path /demo/* {
		reverse_proxy backend:8000
	}

	# ─── Static files + SPA fallback ───────────────────
	handle_path /* {
		try_files {path} {path}/ /index.html
		file_server browse
	}

}
# ----------  end ----------
